var getRunSet=parseInt($(".sectionHeader").attr("runSet"));var runSet=(getRunSet==1)?true:false;var workCenterGroupJSON=false;JSON.stringify=JSON.stringify||function(e){var d=typeof(e);if(d!="object"||e===null){if(d=="string"){e='"'+e+'"'}return String(e)}else{var f,b,c=[],a=(e&&e.constructor==Array);for(f in e){b=e[f];d=typeof(b);if(d=="string"){b='"'+b+'"'}else{if(d=="object"&&b!==null){b=JSON.stringify(b)}}c.push((a?"":'"'+f+'":')+String(b))}return(a?"[":"{")+String(c)+(a?"]":"}")}};$(".boxTitle").find("a").click(function(c){c.preventDefault();var a=$(this).attr("class");var b=$(this).parent();switch(a){case"collapse":$(this).attr("class","expand");$(this).closest(".boxContainer").find(".boxContent").fadeOut("fast");break;case"expand":$(this).attr("class","collapse");$(this).closest(".boxContainer").find(".boxContent").fadeIn("fast");break}});$("#selectReportName").live("change",function(e){var d=$(this);var b="#selectReportWorkCenters";var f="#selectReportOrderStatuses";var c=".reportFilters";var a="#selectReportFilters-code";$.each($("input[id^=selectReportFilters-]"),function(g,h){var i="input#selectReportFilters-";$(i+this.value).attr("checked",false).click().attr("checked",false)});switch($(this).val()){case"WO1002RG":$(b).css("display","none").prev(".specialNote").css("display","none").prev(".hint").css("display","none");$(b).val("");$(f).val("");$(f).css("display","block");$(c).find("label[for=selectReportFilters-item_number]").removeAttr("style");$(c).find("br:nth-child(2)").removeAttr("style");$(c).find("label[for=selectReportFilters-code]").css("display","none");$(a).val("");$(c).find("br:first").css("display","none");break;case"OR1000RG":$(b).css("display","none").prev(".specialNote").css("display","none").prev(".hint").css("display","none");$(b).val("");$(f).val("");$(f).css("display","none").prev(".hint").css("display","none");$(c).find("label[for=selectReportFilters-code]").removeAttr("style");$(c).find("label[for=selectReportFilters-item_number]").css("display","none");$(c).find("br:first").css("display","none");break;case"WO1010RG":$(b).css("display","block").prev(".specialNote").css("display","block").prev(".hint").css("display","block");$(f).css("display","block").prev(".hint").css("display","block");$(f).val("");$(f).css("display","block");$(c).find("label[for=selectReportFilters-item_number]").removeAttr("style");$(c).find("br:nth-child(2)").removeAttr("style");$(c).find("label[for=selectReportFilters-code]").css("display","none");$(a).val("");$(c).find("br:first").css("display","none");break}});var inputDefaultValues=[];inputDefaultValues.item_number="Enter Item #";inputDefaultValues.order_number="Enter Order #";$("input#selectReportFilters-code").live("click",function(){var b=this.id;var a=b.toString().replace(/selectReportFilters-(.*)/g,"$1");var c=$(this).is(":checked")?true:false;var d;switch(c){case true:d=$("<select/>").attr({autocomplete:"off",name:a});d.append('<option value="m" selected="selected">M</option><option value="p">P</option>');var e="label[for="+b+"]";$(d).insertAfter($(e));$("select[name="+a+"]").val("m");break;case false:$("select[name="+a+"]").remove();break}});$("input#selectReportFilters-item_number, input#selectReportFilters-order_number").live("click",function(){var b=this.id;var a=b.toString().replace(/selectReportFilters-(.*)/g,"$1");var c=$(this).is(":checked")?true:false;var d;switch(c){case true:d=$("<input/>").attr({autocomplete:"off",name:a,type:"text",value:inputDefaultValues[a]});var e="label[for="+b+"]";$(d).insertAfter($(e));break;case false:$("input[type=text][name="+a+"]").remove();break}});function updateRunWorkOrderReportForm(){var c=".sectionHeader";var f="#selectReportForm";var e=["runReport","runWorkCenters","runOrderNumber","runItemNumber","runStatus","runCode"];var b=[];if(runSet){$(".runWorkOrderReportContainer").find(".boxTitle").find("a").click();$.each(e,function(g,h){b[h]={stringVal:$(c).attr(h)}});$(f).find("#selectReportName").val(b.runReport.stringVal);
$("#selectReportName").change();var d=b.runWorkCenters.stringVal.split(",");$(f).find("#selectReportWorkCenters").val(d);var a=b.runStatus.stringVal.split(",");$(f).find("#selectReportOrderStatuses").val(a);if(b.runItemNumber.stringVal.length>0){$("input#selectReportFilters-item_number").click().click().attr({checked:true});$("input[name=item_number]").attr({value:b.runItemNumber.stringVal})}if(b.runOrderNumber.stringVal.length>0){$("input#selectReportFilters-order_number").click().click().attr("checked",true);$("input[name=order_number]").attr({value:b.runOrderNumber.stringVal})}if(b.runCode.stringVal.length>0){$("input#selectReportFilters-code").click().click().attr("checked",true);$("select[name=code]").attr({value:b.runCode.stringVal})}}}function calculateTotalBackOrderValue(){var b=".sectionHeader";var c=$(b).attr("runReport");var a=0;switch(c){case"WO1010RG":a=0;$("table").find("tbody").find("tr").find("td:nth-child(8)").each(function(e,g){var f=$.trim(g.innerHTML).replace(/\$/,"");var d=parseFloat(f);a+=d});a=parseFloat(a).toFixed(2);a=a.replace(/\d{1,3}(?=(\d{3})+(?!\d))/g,"$&,");$(".totalBackOrderValue").html(a);break;case"WO1002RG":a=0;$("table").find("tbody").find("tr").find("td:nth-child(4)").each(function(e,g){var f=$.trim(g.innerHTML).replace(/\$/,"");if(f==="NaN"){f=0}var d=parseFloat(f);a+=d});a=parseFloat(a).toFixed(2);a=a.replace(/\d{1,3}(?=(\d{3})+(?!\d))/g,"$&,");$(".totalBackOrderValue").html(a);break}}$("#selectReportRuButton").live("click",function(a){a.preventDefault();$(".mainBoxContainer").overlay({show:true});$("table").find("tbody").find("tr").remove();var h=$("#selectReportName").val();var n=$("#selectReportWorkCenters").val();var f=$("#selectReportOrderStatuses").val();var g=$(".reportFilters").find("input:checked").map(function(p,q){return $(q).val()});if(n){var o=n.join(",")}if(f){var b=f.join(",")}var m=[];var j=[];var k=0;var i;var c=false;var l=0;$("body").attr("currentReport",h);$.each(g.get(),function(q,u){var p=u.match(/_/g)?true:false;var s=u;if(p){s=u.toString().replace(/_/g,"-")}var r=(u==="code")?s+"/"+$("select[name="+u+"]").val():s+"/"+$("input[name="+u+"]").val();var t=(u==="code")?$("select[name="+u+"]").val():$("input[name="+u+"]").val();if(jQuery.trim(t)===inputDefaultValues[u]){$("input#selectReportFilters-"+u).attr("checked",false).click().attr("checked",false)}else{m.push(r)}});j.push("run/"+h);if(o){j.push("work-center/"+o)}if(b){j.push("order-status/"+b)}j.push(m.join("/"));var d=j.join("/");var e=(d.length>=1)?"/"+d:d;window.location.replace(siteURL+"work-order/index"+e)});$(".saveWorkOrderTableReport").click(function(b){b.preventDefault();var c=".sectionHeader";var d=$(c).attr("runReport");var a=$(".sectionHeader").attr("runWorkCenters");var e="";switch(d){case"WO1010RG":e="{'0':'Co/Wo No.','1':'Order Status','2':'WC','3':'Item #','4':'Description','5':'Order Qty','6':'B/O Qty','7':'B/O Value','8':'Build Time (Hrs)','9':'U/M','10':'Due Date'}";break;case"WO1002RG":e="{'0':'Item #','1':'Item Description','2':'B/O Qty','3':'B/O Value','4':'Status','5':'Co/Wo No.','6':'Order Qty'}";break}$("table").tabletojson({headers:e,onComplete:function(f){$("input#report").val(d);$("input#bo_value").val($(".totalBackOrderValue").html().toString().replace(/\,/g,""));$("input#record_count").val(parseInt($(".totalRecordsNumber").html()));$("textarea#work_centers").val((d==="WO1010RG")?a:"");$("textarea#work_center_groups").val(workCenterGroupJSON?workCenterGroupJSON.toSource().replace(/^(\()(.*)(\))$/,"$2").replace(/(\w+)\:/g,'"$1":'):"");$("textarea#postData").val(encodeURI(f));$('form[method="post"]').submit()}})});$(".saveWorkOrderTableReportBackup").click(function(b){b.preventDefault();$(".results-count").overlay({show:true});var c=".sectionHeader";var d=$(c).attr("runReport");var a=$(".sectionHeader").attr("runWorkCenters");var e="";switch(d){case"WO1010RG":e="{'0':'Co/Wo No.','1':'Order Status','2':'WC','3':'Item #','4':'Description','5':'Order Qty','6':'B/O Qty','7':'B/O Value','8':'Build Time (Hrs)','9':'U/M','10':'Due Date'}";
break;case"WO1002RG":e="{'0':'Item #','1':'Item Description','2':'B/O Qty','3':'B/O Value','4':'Status','5':'Co/Wo No.','6':'Order Qty'}";break}$("table").tabletojson({headers:e,onComplete:function(f){$.ajax({beforeSend:function(g){g.overrideMimeType("application/json; charset=UTF-8")},cache:false,dataType:"json",data:{postData:encodeURI(f),report:d,bo_value:$(".totalBackOrderValue").html().toString().replace(/\,/g,""),record_count:parseInt($(".totalRecordsNumber").html()),work_centers:(d==="WO1010RG")?a:"",work_center_groups:workCenterGroupJSON?workCenterGroupJSON.toSource().replace(/^(\()(.*)(\))$/,"$2").replace(/(\w+)\:/g,'"$1":'):""},success:function(){$(".results-count").overlay({show:false});abortAjaxRequest=false},type:"POST",url:siteURL+"ajax/save-work-order-table-report"})}})});$(".applyWorkCenterGroups").find("button").live("click",function(b){b.preventDefault();var f=["blue","red","green","purple","orange"];var c={};var d=0;$(".applyWorkCenterGroups").overlay({show:true});var h=$(".sectionHeader").attr("runReport");var e=$(".sectionHeader").attr("runWorkCenters");var k=parseInt(e);var q=(k>=1)?"/work-center/"+e:"";var i=(h==="WO1002RG")?"WO1002RG":false;var p=(h==="WO1010RG")?"WO1010RG":i;var o=p;var g=[];var j={};var l=[];var a={};var n;var m=false;$("table").find("tbody").find("tr").each(function(r,s){$(this).removeAttr("class")});$(".appliedWorkCenterGroupData").find("ul").find("li, ul").remove();xhr=$.getJSON(siteURL+"ajax/get-work-center-group"+q,function(s){workCenterGroupJSON=s;$(".tableResultsContainer").overlay({show:true});abortAjaxRequest=false;if(s.data.length>=1){$.each(s.data,function(u,w){var z=w.wcg_id;var y=w.cwwcid;var x=w.wcg_staffing*formula;var v=parseInt(l.indexOf(z))==0;if(!v){l.push(z);a[z]={labor:x,breakPoint:false}}g.push(y);j[y]={group:z,labor:x}});if(o){var r=false;var t=false;if(o==="WO1010RG"){r="td:nth-child(3)";t="td:nth-child(9)"}if(r){$("table").find("tbody").find("tr").find(r).each(function(x,A){var B=$.trim(A.innerHTML).toString();var v=parseFloat($(this).closest("tr").find(t).html());var y=parseInt($.inArray(B,g))>=0;if(y){var u=j[B].group;var w=a[u].labor;var z=w-=v;z=parseFloat(z).toFixed(2);if(a[u].breakPoint){$(this).closest("tr").attr("class","blur")}else{if(z>=0){a[u].labor-=v;a[u].labor=parseFloat(a[u].labor).toFixed(2);j[B].labor-=v;j[B].labor=parseFloat(j[B].labor).toFixed(2)}else{$(".applyWorkCenterGroups").overlay({show:false});a[u].breakPoint=true;$(this).closest("tr").attr("class","blueBreak blur").css("border-color",f[d]);c[u]={color:f[d]};d++}}}})}}$.each(a,function(v,x){var u=!(c[v]==undefined)?c[v].color:"transparent";var w=$("<li>").attr("group_id",v).html('<span class="colorCode" style="background:'+u+';"></span>Group <span class="bold underlined">'+v+'</span> : <span class="bold underlined">'+x.labor+"</span> avail. production hours.");$(".appliedWorkCenterGroupData").find("ul:nth-child(1)").append(w)})}else{}$(".tableResultsContainer").overlay({show:false});$(".applyWorkCenterGroups").overlay({show:false})});$(".applyWorkCenterGroups").find("p:nth-child(1)").find("span:nth-child(1)").attr("class","bold").html("Work center group(s) applied.");$(".applyWorkCenterGroups").find("button").html("Re-apply Work Center Groups")});$(".applyWorkCenterGroups").css("display",runSet?"block":"none");updateRunWorkOrderReportForm();calculateTotalBackOrderValue();if($(".sectionHeader").attr("runReport")===""){$(".reportFilters").find("label[for=selectReportFilters-code]").css("display","none");$(".reportFilters").find("br:first").css("display","none")}if($(".sectionHeader").attr("runReport")!=="OR1000RG"){$("table").tablesorter()}else{var getRunCode=($(".sectionHeader").attr("runCode")!=="")?$(".sectionHeader").attr("runCode"):false;if(getRunCode){$("#or1000rgTable").overlay({show:true});$("table#or1000rgTable").find("tbody").find("tr.workOrderRow").each(function(a,b){if($(this).next().attr("class")==="orderTotals"){$(this).next().remove();$(this).remove()}});$("#or1000rgTable").overlay({show:false})
}};