(function($){$.fn.extend({tabletojson:function(options){var defaults={headers:null,attributes:null,onComplete:null,dumpElement:null};options=$.extend(defaults,options);return this.each(function(){var o=options;var $tbl=$(this);var headerList=[];var attribList=[];var headerArray=eval("("+o.headers+")");var attribArray=eval("("+o.attributes+")");if(o.headers!==null){for(h in headerArray){nvp={};nvp.Name=h;nvp.Value=headerArray[h];headerList[headerList.length]=nvp}}else{headerList=getHeaders($tbl)}if(o.attributes!==null){for(h in attribArray){nvp={};nvp.Name=h;nvp.Value=attribArray[h];attribList[attribList.length]=nvp}}var json=buildJSON($tbl,attribList,headerList);$(o.dumpElement).val(json);if(o.onComplete!==null){o.onComplete(json)}return this})}});function buildJSON($table,a,h){var sb=new StringBuilder();var sbv=new StringBuilder();var values=[];var rows=[];sb.append("[");$table.find("tbody tr:not(:has('th'))").each(function(){sbv.clear();sbv.append("{");values.length=0;for(x=0;x<h.length;x++){values[values.length]='"'+h[x].Value+'":"'+escaper($(this).find("td").eq(h[x].Name).text())+'"'}for(x=0;x<a.length;x++){var name=$(this).attr(a[x].Name);var val=a[x].Value;name=typeof(name)=="undefined"?"":name;val=typeof(val)=="undefined"?"":val;values[values.length]='"'+val+'":"'+name+'"'}sbv.append(values.join(","));sbv.append("}");rows[rows.length]=sbv.toString()});sb.append(rows.join(","));sb.append("]");return sb.toString()}function getHeaders($table){var h=[];var cnt=0;$table.find("tr th").each(function(){var nvp={};nvp.Name=String(cnt);nvp.Value=$(this).text();h[h.length]=nvp});return h}})(jQuery);function StringBuilder(a){this.strings=[""];this.append(a)}StringBuilder.prototype.append=function(a){if(a){this.strings.push(a)}};StringBuilder.prototype.clear=function(){this.strings.length=1};StringBuilder.prototype.toString=function(){return this.strings.join("")};function escaper(a){return a.replace(/(\")/g,"\\$1")};